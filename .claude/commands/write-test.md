# write-test コマンド

指定されたReact Nativeコンポーネントのテストを作成してください。

## 作業手順

1. **既存テストパターンの確認**
   - `__tests__/screens/` 内の既存テスト（特に `TopScreen.test.tsx`）を参考にする
   - プロジェクトのテスト規約やパターンを理解する

2. **テストファイルの準備**
   - 適切な場所にテストファイルを作成（通常は `__tests__/screens/[ComponentName].test.tsx`）
   - 必要なインポートとモックを設定

3. **テストケースの実装**
   - コンポーネントが正しくレンダリングされるか
   - データが適切に表示されるか
   - ユーザーインタラクションが正しく動作するか
   - エラー状態やローディング状態の処理

4. **テストの実行と検証**
   - テストがパスすることを確認
   - 必要に応じて設定ファイルを更新

## 重要な原則

### データベースの扱い
このプロジェクトではWatermelonDBをモックせず、実際のデータベースインスタンスを使用してテストします。
テスト環境ではデータベースが自動的にクリーンアップされるため、実際のデータ操作をテストに含めることで信頼性の高いテストを実現します。

### モックすべきもの
- ネイティブモジュール（音声再生、カメラ、位置情報など）
- 外部API呼び出し
- アセットファイル（画像、音声ファイルなど）

### テストデータの準備
- データベースは `src/database` からインポート（グローバルインスタンス）
- テストヘルパー関数は `__tests__/helpers/databaseHelpers.ts` に定義
- ヘルパーがない場合は `database.write()` で直接作成可能

### UIコンポーネントのテスト
```typescript
// 例：ボタンのテスト
const touchableOpacities = component.root.findAllByType(TouchableOpacity);
const targetButton = touchableOpacities.find(button => {
  // ボタンを特定するロジック
});
```

### Jest設定の更新
新しいライブラリを追加した場合、`jest.config.js` の更新が必要になることがあります：
- `transformIgnorePatterns` に新しいライブラリを追加
- `moduleNameMapper` でアセットファイルの拡張子を追加

## 期待される成果物

- 網羅的なテストケースを含むテストファイル
- 全てのテストがパスすること
- 必要に応じた設定ファイルの更新
- 将来の変更に対して堅牢なテスト