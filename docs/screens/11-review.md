# 復習画面 仕様書

## 画面概要
SRS（間隔反復学習）システムに基づいて復習が必要な単語を表示し、「覚えた/覚えてない」の2択フィードバックで学習進捗を管理する画面。

## 復習対象の単語
- **テスト間違い問題**: リスニング・リーディングテストで間違えた単語
- **学習モードでマーク**: 学習画面で「復習に追加」された単語
- **SRS間隔到達**: 前回「覚えてない」選択から一定期間経過した単語

## レイアウト構成
- **ヘッダー**: 復習タイトル、残り件数表示、戻るボタン
- **メインエリア**: 単語カード表示エリア
- **フッター**: 覚えた/覚えてないボタン

## UI要素詳細

### ヘッダー部分
- **タイトル表示**: 「復習」
- **残り件数**: 例「残り 15語」
- **戻るボタン**: トップ画面へ戻る
- **配置**: 画面上部

### 単語カード表示エリア
- **韓国語単語**: 大きなフォントで表示
- **音声自動再生**: 画面表示時に韓国語音声を自動再生
- **意味表示**: タップで日本語訳表示/非表示切り替え
- **例文表示**: タップで韓国語例文+日本語訳を表示
- **配置**: 画面中央の大部分

### フィードバックボタン
- **覚えたボタン**: 緑色、大きめのボタン
- **覚えてないボタン**: 赤色、大きめのボタン
- **配置**: 画面下部に横並び
- **動作**: タップ後、次の復習単語へ自動遷移

## SRS（簡易間隔反復学習）システム

**詳細仕様**: [SRSシステム仕様書](../srs-system.md)を参照

### 出題順序
- **復習優先度順**: 忘れやすい単語（間違いが多い、期間が経過）を先に表示
- **計算要素**: 
  - 次回復習予定日（期限切れを優先）
  - 間違い回数（多いほど優先）
  - 最終学習日（古いほど優先）

## 状態管理

### 復習対象データ取得
- **データソース**: 
  - テスト結果（間違い問題）
  - 学習履歴（マークされた単語）
  - SRS履歴（復習スケジュール）
- **フィルタリング**: 本日復習対象のみを抽出

### フィードバック処理
- **覚えた選択時**: 
  - 次回復習日を延長（間隔を拡大）
  - 習得レベルを上昇
- **覚えてない選択時**: 
  - 次回復習日を短縮（1日後に再設定）
  - 間違い回数を増加

## データ構造

### 復習対象単語データ
```javascript
{
  word_id: "word_001",
  korean: "안녕하세요",
  japanese: "こんにちは", 
  example_korean: "안녕하세요, 만나서 반갑습니다.",
  example_japanese: "こんにちは、お会いできて嬉しいです。",
  audio_url: "/audio/word_001.mp3",
  grade: 3,  // 該当級
  source: "test_mistake",  // 復習追加の理由
  priority: 85  // 復習優先度スコア
}
```

### SRS管理データ
```javascript
{
  word_id: "word_001",
  mastery_level: 2,  // 習得レベル（0-9: 0-8=復習対象, 9=習得完了）
  next_review_date: "2025-06-14T09:00:00Z",
  interval_days: 3,  // 現在の復習間隔
  mistake_count: 1,  // 間違い回数
  last_reviewed: "2025-06-13T10:30:00Z"
}
```

### 学習進捗更新データ
```javascript
{
  date: "2025-06-13",
  grade: 3,
  mastered_words_count: 150,  // その日時点で覚えた単語数
  total_words_count: 2000     // その級の総語彙数
}
```

## 機能詳細

### 音声自動再生
- **トリガー**: 新しい単語表示時に自動実行
- **実装**: Expo AVまたはReact Native Sound
- **フォールバック**: 音声なしの場合は発音表記を強調表示

### フィードバック処理詳細
**詳細なアルゴリズム**: [SRSシステム仕様書](../srs-system.md)を参照

### 学習進捗データ更新
- **更新タイミング**: 復習セッション終了時
- **計算方法**: 
  ```javascript
  mastered_words_count = SRS管理データで mastery_level >= 9 の件数
  progress_rate = (mastered_words_count / total_words_count) * 100
  ```

## ナビゲーション

### 復習完了時
- **条件**: 復習対象が0件になった
- **表示**: 「本日の復習完了！」メッセージ
- **動作**: 3秒後自動でトップ画面へ戻る

### 中断時
- **戻るボタン**: 復習途中でもトップ画面へ戻る
- **進捗保存**: 現在までのフィードバック結果は保存済み
- **継続**: 次回復習時は残りの単語から再開

## エラーハンドリング

### 復習対象なし
- **対応**: 「復習対象がありません」メッセージ表示
- **動作**: 3秒後自動でトップ画面へ戻る

### 音声再生失敗
- **対応**: 音声なしで継続、発音表記を表示
- **ログ**: エラーログを記録（デバッグ用）

### データ更新失敗
- **対応**: フィードバック結果をローカルキューに保存
- **リトライ**: 次回アプリ起動時に再試行

## 技術要件

### 必要なデータ
- 復習対象単語の一覧
- 各単語のSRS管理データ
- 音声ファイル
- 級別総語彙数（進捗率計算用）

### ローカルストレージ
- SRS管理データ（単語別）
- 学習進捗履歴（日別・級別）
- 復習セッション履歴

### パフォーマンス要件
- 復習対象抽出: 1秒以内
- フィードバック処理: 即座に次の単語表示
- データ更新: バックグラウンド処理

---
*ファイル作成日: 2025/6/13*
*実装担当: AIエージェント*