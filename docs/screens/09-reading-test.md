# リーディングテスト画面 仕様書

## 画面概要
選択されたユニットの単語を韓国語テキストで出題し、4択の日本語訳から正解を選ぶテスト画面。

## レイアウト構成
- **ヘッダー**: 級+ユニット表示、進捗表示、戻るボタン
- **メインエリア**: 韓国語単語表示 + 4択選択肢
- **フッター**: 次へボタン、音声再生ボタン

## UI要素詳細

### ヘッダー部分
- **級+ユニット表示**: 例「3級 リーディングテスト ユニット1-10 (5/10)」
- **進捗バー**: 現在の問題番号/総問題数の視覚表示
- **戻るボタン**: リーディングユニット選択画面へ戻る
- **配置**: 画面上部

### 韓国語単語表示エリア
- **単語表示**: 大きなフォントで韓国語単語を中央配置
- **フォントサイズ**: 24px以上の読みやすいサイズ
- **配置**: 画面中央上部

### 4択選択肢
- **選択肢表示**: 4つの日本語訳を縦並びで表示
- **選択状態**: タップで選択、選択中は色変更
- **選択肢生成**: 正解+似た意味の間違い選択肢3つ
- **配置**: 画面中央下部

### 操作ボタン
- **次へボタン**: 選択肢を選んだ後に有効化
- **音声再生ボタン**: 韓国語単語の音声を再生
- **配置**: 画面下部

## 状態管理

### 画面パラメータ
- **級情報**: ナビゲーションパラメータで管理（例: `grade: 3`）
- **ユニット情報**: ナビゲーションパラメータで管理（例: `unit: 1`）
- **表示**: ヘッダー部分に級+ユニット表示

### テスト進捗管理
- **現在位置**: 何問目かをローカル状態で管理
- **回答状況**: 各問題の正解/不正解を記録
- **所要時間**: 問題ごとの回答時間を記録（将来の分析用）

## データ構造

### 問題データ
```javascript
{
  id: "word_001",
  korean: "안녕하세요",
  audio_url: "/audio/word_001.mp3", // 音声はオプション
  correct_answer: "こんにちは",
  options: [
    "こんにちは",      // 正解
    "さようなら",      // 間違い選択肢
    "ありがとう",      // 間違い選択肢
    "すみません"       // 間違い選択肢
  ]
}
```

### テスト結果データ
```javascript
{
  grade: 3,
  unit: 1,
  test_type: "reading",
  results: [
    { word_id: "word_001", correct: true, time: 5.2 },
    { word_id: "word_002", correct: false, time: 12.8 }
  ],
  total_score: 8,
  total_questions: 10,
  test_date: "2025-06-13T10:30:00Z"
}
```

## 機能詳細

### 韓国語単語表示
- **フォント**: 韓国語に対応したフォント（Noto Sans KR等）
- **文字サイズ**: 視認性を重視した大きなサイズ
- **表示時間**: 制限なし（じっくり読める）

### 音声再生
- **トリガー**: 手動ボタンのみ（自動再生なし）
- **実装**: Expo AVまたはReact Native Sound
- **フォールバック**: 音声ファイルが存在しない場合はエラー表示

### 選択肢生成
- **正解**: 単語の正しい日本語訳
- **間違い選択肢**: 同級の他の単語から3つランダム選択

### 回答処理
- **選択時**: 選択肢の色変更、次へボタン有効化
- **次へボタン**: 回答記録 + 次の問題へ移動
- **最終問題**: テスト結果画面へ遷移

## ナビゲーション

### 問題回答後
- **条件**: 選択肢選択 + 次へボタン
- **動作**: 正解/不正解を表示
- **次の問題**: 確認後に次の問題へ進む

### テスト完了時
- **条件**: 全10問完了
- **動作**: テスト結果を記録してリーディングユニット選択画面へ戻る
- **データ保存**: 1問ごとにテスト結果をローカルストレージに保存

### 中断時
- **戻るボタン**: テスト途中でもリーディングユニット選択画面へ戻る
- **確認ダイアログ**: 「テストを中断しますか？」
- **進捗破棄**: 現在のテスト結果は保存しない

## エラーハンドリング

### 問題データなし
- **対応**: エラーメッセージ表示後、ユニット選択画面へ戻る
- **メッセージ**: 「問題データの読み込みに失敗しました」

### 不正な選択肢データ
- **対応**: 選択肢が4つ未満の場合、ランダムで補完
- **フォールバック**: 同級の他単語から選択肢生成

### 韓国語フォント表示失敗
- **対応**: システムフォントで代替表示
- **警告**: 「韓国語フォントの読み込みに失敗しました」

## 技術要件

### 必要なデータ
- ナビゲーションパラメータから級+ユニット情報を取得
- 指定されたユニットの単語データ（10問分）
- 各単語の音声ファイル
- 同級語彙データ（ランダム選択肢生成用）
- 韓国語フォント（Noto Sans KR等）

### ローカルストレージ
- テスト結果（問題別詳細 + 全体スコア）
- テスト履歴（日時、スコア、所要時間）
- 間違えた問題の記録（復習用）

## リスニングテストとの違い

### 主な相違点
- **出題形式**: 音声 → 韓国語テキスト表示
- **自動再生**: あり → なし
- **音声ボタン**: メイン → サブ（手動のみ）
- **フォント要件**: なし → 韓国語フォント必須
- **表示時間**: 音声長さ → 制限なし

### 共通点
- 4択選択形式
- 進捗管理
- データ構造
- ナビゲーション
- エラーハンドリング

---
*ファイル作成日: 2025/6/13*
*実装担当: AIエージェント*