# テストユニット選択画面 仕様書

## 画面概要
選択された級とテストモード（リスニング/リーディング）に対して、テストを行うユニットを選択する統合画面。

## 統合仕様について
この画面は従来の`05-listening-unit-selection.md`と`06-reading-unit-selection.md`を統合し、
テストモードパラメータに応じて動的にUI・遷移先を変更する単一の画面として実装されています。

## UI参考資料
[元画像](../../docs/original-materials/ユニット選択.png)
※ 学習用ユニット選択画面とほぼ同じレイアウト

## レイアウト構成
- **ヘッダー**: 選択された級+テストモードの表示 + 戻るボタン + ホームボタン
- **説明テキスト**: テストモード別の説明文
- **メインエリア**: ユニット選択ボタン一覧（グリッド表示）

## UI要素詳細

### ヘッダー部分
- **級+モード表示**: 選択された級とテストモードを動的表示
  - リーディングモード: 「3級 リーディングテスト」
  - リスニングモード: 「3級 リスニングテスト」
- **戻るボタン**: テストモード選択画面へ戻る
- **ホームボタン**: トップ画面への直接遷移
- **配置**: 画面上部

### 説明テキスト
- **リーディングモード**: 「📖 ハングル文字を見て日本語訳を4択から選択してください」
- **リスニングモード**: 「🎧 音声を聞いて日本語訳を4択から選択してください」

### ユニット選択ボタン
- **表示形式**: 「ユニット 1-10」「ユニット 11-20」...の形式
- **問題数表示**: 各ユニット「10問」を表示
- **配置**: 縦並び、複数列表示対応
- **スタイル**: テストモード別カラーテーマ
  - リーディングモード: ティール系（`bg-teal-50`, `border-teal-500`）
  - リスニングモード: パープル系（`bg-purple-50`, `border-purple-500`）
- **タップ動作**: テストモードに応じた遷移先へ

### 遷移先の動的変更
- **リーディングモード**: ReadingTest画面 (`09-reading-test.md`)
- **リスニングモード**: ListeningTest画面 (`08-listening-test.md`)

### ユニットデータの取得
**データベース駆動**: UNITSテーブルから級別ユニット一覧を取得
- **クエリ**: `SELECT * FROM units WHERE grade = ? ORDER BY unit_number`
- **表示名計算**: `{(unit_number-1)*10+1}-{unit_number*10}`
- **useUnits hook**: データ取得・ローディング・エラー状態管理

各級のユニット数（requirements.mdより）：
- **1級**: 40ユニット
- **2級**: 140ユニット
- **3級**: 200ユニット
- **4級**: 200ユニット
- **5級**: 300ユニット
- **6級**: 300ユニット

## 状態管理

### 画面パラメータ
- **級情報**: ナビゲーションパラメータ `level: number`
- **テストモード**: ナビゲーションパラメータ `testMode: 'reading' | 'listening'`
- **引き継ぎ**: 次のテスト画面に級+ユニット情報を渡す

## ナビゲーション

### 戻るボタン
- **動作**: テストモード選択画面へ戻る
- **遷移先**: `04-test-mode-selection.md`

### ホームボタン
- **動作**: トップ画面への直接遷移
- **遷移先**: `01-top.md`

### ユニット選択時の遷移
- **リーディングモード**: `SCREEN_NAMES.READING_TEST`へ遷移
- **リスニングモード**: `SCREEN_NAMES.LISTENING_TEST`へ遷移
- **パラメータ**: `{ level: number, unitNumber: number }`

## スクロール対応

### 長いリスト表示
- **対応**: 縦スクロール対応（特に高級レベル）
- **実装**: ScrollViewで全ユニットを表示

## エラーハンドリング

### 不正なパラメータ
- **級パラメータ不正**: route.paramsが存在しない場合はクラッシュ
- **テストモード不正**: 'reading' | 'listening' 以外は型エラー

### データ読み込み失敗
- **ローディング状態**: ActivityIndicatorで読み込み中表示
- **エラー状態**: エラーメッセージと戻るボタン表示
- **空データ**: ヘッダーのみ表示（ユニットボタンなし）

## 技術要件

### 実装ファイル
- **コンポーネント**: `src/screens/TestUnitSelectionScreen.tsx`
- **テストファイル**: `src/screens/__tests__/TestUnitSelectionScreen.test.tsx`

### 必要なデータ
- ナビゲーションパラメータから級情報・テストモードを取得
- **データベース**: UNITSテーブルからの級別ユニット一覧
- **useUnits hook**: データ取得・ローディング・エラー状態管理

### スタイリング
- **フレームワーク**: NativeWind (Tailwind CSS for React Native)
- **テーマ**: テストモード別カラーテーマ適用

---
*ファイル作成日: 2025/6/20*
*実装担当: AIエージェント*
*備考: 05-listening-unit-selection.md と 06-reading-unit-selection.md を統合*