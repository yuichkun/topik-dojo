# 学習画面 仕様書

## 画面概要
選択されたユニットの単語を1問ずつ表示し、ユーザーが単語を学習する画面。フラッシュカード形式で表示する。

## レイアウト構成
- **ヘッダー**: 級+ユニット表示、進捗表示、戻るボタン
- **メインエリア**: 単語カード表示エリア
- **フッター**: 操作ボタン（復習に追加/復習予定表示、次へ、前へ）

## UI要素詳細

### ヘッダー部分
- **級+ユニット表示**: 例「3級 ユニット1-10 (5/10)」
- **進捗バー**: 現在の問題番号/総問題数の視覚表示
- **戻るボタン**: ユニット選択画面へ戻る
- **配置**: 画面上部

### 単語カード表示エリア
- **ハングル表示**: 大きなフォントで韓国語単語を表示
- **音声再生ボタン**: タップで韓国語音声再生
- **日本語訳表示**: タップで表示/非表示切り替え
- **例文表示**: タップで韓国語例文+日本語訳を表示（折りたたみ可能）
- **配置**: 画面中央の大部分を占める

### 操作ボタン
- **復習ボタン/復習予定表示**: 
  - 未登録の場合: 「復習に追加」ボタン（タップでSRSに登録）
  - 登録済みの場合: 「○日後に復習予定」テキスト表示（非活性）
- **次へボタン**: 次の単語へ進む
- **前へボタン**: 前の単語に戻る（最初の問題以外で表示）
- **配置**: 画面下部

## 状態管理

### 画面パラメータ
- **級情報**: ナビゲーションパラメータで管理（例: `grade: 3`）
- **ユニット情報**: ナビゲーションパラメータで管理（例: `unit: 1`）
- **表示**: ヘッダー部分に級+ユニット表示

### 学習進捗管理
- **現在位置**: 何問目かをローカル状態で管理
- **復習登録状況**: 各単語のSRS_MANAGEMENTテーブル登録状況をリアルタイム取得
- **次回復習予定**: 登録済み単語の復習予定日を取得して日数表示

## データ構造

### 単語データの取得
**データベース駆動**: WORDSテーブルから指定ユニットの単語を取得
- **クエリ**: `SELECT w.* FROM words w JOIN units u ON w.unit_id = u.id WHERE u.id = ? ORDER BY w.unit_order`
- **順序**: unit_orderフィールドで1-10の順序を保証

### 単語データ構造
```javascript
{
  id: "word_001",
  korean: "안녕하세요",
  japanese: "こんにちは",
  example_korean: "안녕하세요, 만나서 반갑습니다.",
  example_japanese: "こんにちは、お会いできて嬉しいです。",
  unit_id: "unit_3_1",
  unit_order: 1,
  audio_url: "/audio/word_001.mp3"  // ファイルパスルールで生成
}
```

### SRS登録データ（復習に追加時）
```javascript
{
  word_id: "word_001",
  mastery_level: 0,
  ease_factor: 2.5,
  next_review_date: 明日のUnixTimestamp,
  interval_days: 1,
  mistake_count: 0,  // 学習モードでは0からスタート
  last_reviewed: null
}
```

### 復習予定日数計算
```javascript
// 今日から次回復習予定日までの日数を計算
function calculateDaysToReview(nextReviewDate) {
  const today = new Date();
  const reviewDate = new Date(nextReviewDate);
  const diffTime = reviewDate.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return Math.max(0, diffDays); // 負の値は0にする
}
```

## 機能詳細

### 音声再生
- **トリガー**: 音声ボタンタップ
- **実装**: Expo AVまたはReact Native Sound
- **フォールバック**: 音声ファイルが存在しない場合はボタン無効化

### 日本語訳表示切り替え
- **初期状態**: 非表示
- **切り替え**: カードエリアタップで表示/非表示
- **アニメーション**: フェードイン/フェードアウト

### 例文表示
- **初期状態**: 折りたたみ
- **展開**: 「例文を見る」ボタンタップ
- **内容**: 韓国語例文 + 日本語訳を同時表示

## ナビゲーション

### 学習完了時
- **条件**: 全10問完了
- **動作**: 学習結果画面表示後、ユニット選択画面へ戻る
- **データ保存**: 学習完了状況をローカルストレージに保存

### 中断時
- **戻るボタン**: 学習途中でもユニット選択画面へ戻る
- **進捗保存**: 現在位置を保存（次回同じユニット選択時に継続可能）

## エラーハンドリング

### 単語データなし
- **対応**: エラーメッセージ表示後、ユニット選択画面へ戻る
- **メッセージ**: 「単語データの読み込みに失敗しました」

### 音声再生失敗
- **対応**: 音声ボタンを無効化、テキストで「音声なし」表示
- **代替**: 発音表記を強調表示

## 技術要件

### 必要なデータ
- ナビゲーションパラメータから級+ユニット情報を取得
- **データベース**: WORDSテーブルから指定ユニットの単語データ（10問分）
- **getWordsByUnitId query**: ユニットIDで単語一覧を取得
- 音声ファイル（各単語、ファイルパスルールで自動生成）
- ユーザーの学習進捗状況

### ローカルストレージ
- 学習完了状況（ユニット単位）
- 復習マークされた単語のリスト
- 学習履歴

---
*ファイル作成日: 2025/6/13*
*実装担当: AIエージェント*