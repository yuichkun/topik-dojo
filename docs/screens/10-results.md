# 成績確認画面 仕様書

## 画面概要
選択された級のテスト結果を可視化し、学習進捗を確認できる画面。リスニングとリーディングの正答率を円グラフで表示。

## レイアウト構成
- **ヘッダー**: 級表示、戻るボタン
- **メインエリア**: 円グラフ2つ（リスニング/リーディング）

## UI要素詳細

### ヘッダー部分
- **級表示**: 例「3級 成績確認」
- **戻るボタン**: 学習モード選択画面へ戻る
- **配置**: 画面上部

### 円グラフエリア
- **リスニング成績**: 左側に配置
- **リーディング成績**: 右側に配置
- **グラフ表示**: 正答率を円グラフで視覚化
- **色分け**: 正解（緑）、不正解（赤）
- **パーセンテージ**: グラフ中央に大きく表示
- **配置**: 画面中央上部


## 状態管理

### 画面パラメータ
- **級情報**: ナビゲーションパラメータで管理（例: `grade: 3`）
- **表示**: ヘッダー部分に級表示

### データ取得
- **テスト結果**: 指定された級の全テスト結果をローカルストレージから取得
- **正答率計算**: リスニング/リーディング別の正答率を計算
- **学習進捗データ**: 積み重ね式グラフ用の日毎進捗率データを取得

## データ構造

### 成績データ（日時別テスト結果を記録）
```javascript
{
  grade: 3,
  // テスト結果の履歴（正答率統計用）
  test_results: [
    {
      date: "2025-06-13T10:30:00Z",
      test_type: "listening", 
      unit: 1,
      correct_answers: 8,
      total_questions: 10
    }
  ],
  // 学習進捗の履歴（積み重ね式グラフ用）
  learning_progress: [
    {
      date: "2025-06-13",
      mastered_words: 150,  // 覚えた単語数
      total_words: 2000,    // 3級総語彙数
      progress_rate: 7.5    // 進捗率（%）
    },
    {
      date: "2025-06-14", 
      mastered_words: 170,
      total_words: 2000,
      progress_rate: 8.5
    }
  ]
}
```

### 円グラフ用データ
```javascript
{
  listening: {
    data: [
      { value: 80, color: '#4CAF50', label: '正解' },
      { value: 20, color: '#F44336', label: '不正解' }
    ],
    centerText: '80%'
  },
  reading: {
    data: [
      { value: 75, color: '#4CAF50', label: '正解' },
      { value: 25, color: '#F44336', label: '不正解' }
    ],
    centerText: '75%'
  }
}
```

## 機能詳細

### 円グラフ表示
- **ライブラリ**: React Native Chart Kit または Victory Native
- **アニメーション**: グラフ表示時にアニメーション効果
- **インタラクション**: タップでモード別詳細表示（将来対応）

### 正答率計算
- **リアルタイム更新**: テスト完了時に自動更新
- **精度**: 小数点第1位まで表示
- **データなし**: テスト未実施の場合は「データなし」表示

## ナビゲーション

### 戻るボタン
- **遷移先**: 学習モード選択画面
- **データ保持**: 現在の級情報を維持

### 詳細表示（将来対応）
- **トリガー**: 円グラフタップ
- **表示内容**: モード別詳細統計
- **実装**: モーダルまたは新画面

## エラーハンドリング

### データなし
- **対応**: プレースホルダー表示「まだテストを実施していません」
- **代替表示**: 0%の円グラフを表示
- **メッセージ**: 「テストを実施すると成績が表示されます」

### データ破損
- **対応**: エラーメッセージ表示「データの読み込みに失敗しました」
- **フォールバック**: 空の状態を表示
- **リセット**: データリセット機能の提供

### グラフ描画失敗
- **対応**: 数値のみの表示に切り替え
- **警告**: 「グラフの表示に失敗しました」

## 技術要件

### 必要なライブラリ
- **グラフライブラリ**: React Native Chart Kit または Victory Native
- **日時処理**: Day.js または date-fns
- **アニメーション**: React Native Reanimated（オプション）

### 必要なデータ
- ナビゲーションパラメータから級情報を取得
- 指定された級の全テスト結果データ
- 円グラフ描画用の色設定

### ローカルストレージ
- テスト結果の履歴データ
- 統計データのキャッシュ（パフォーマンス向上）

## 将来対応機能

### グラフ拡張（requirements.mdより）
- **日毎進捗**: 折れ線グラフで学習進捗を表示
- **積み重ね式グラフ**: 期間別の学習量を可視化

### 積み重ね式グラフ仕様
- **目的**: その級の語彙習得進捗を日毎に可視化
- **計算方法**: 覚えた単語数 ÷ その級の総語彙数 × 100（%）
- **表示形式**: 0%（初日）→ 100%（全語彙制覇）まで積み上がる
- **例**: 3級（2000語）で600語覚えた場合 → 30%進捗

### 学習進捗データ更新仕様
- **単語習得状態変更**: 復習モードの「覚えた/覚えてない」フィードバック時
- **進捗データ更新**: 復習セッション終了時に、その日の進捗率を計算・記録
- **日次集計**: 1日1回、その日の最終的な習得単語数で進捗率を更新
- **初期状態**: 各級の初回アクセス時にmastered_words=0で初期化

### 必要な関連データ構造
```javascript
// 個別単語の習得状態管理
word_mastery: {
  "word_001": {
    mastered: true,
    mastery_date: "2025-06-12T15:20:00Z"
  },
  "word_002": {
    mastered: false,
    last_reviewed: "2025-06-13T11:00:00Z"
  }
}
```


---
*ファイル作成日: 2025/6/13*
*実装担当: AIエージェント*