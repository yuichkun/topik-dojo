# 成績確認画面 仕様書

## 画面概要
選択された級のテスト結果を可視化し、学習進捗を確認できる画面。リスニングとリーディングの正答率を円グラフで表示。積み重ね式グラフで日毎の語彙習得進捗を可視化。

## レイアウト構成
- **ヘッダー**: 級表示、戻るボタン
- **メインエリア**: 円グラフ2つ（リスニング/リーディング）
- **下部エリア**: 積み重ね式グラフ（語彙習得進捗の日毎推移）

## UI要素詳細

### ヘッダー部分
- **級表示**: 例「3級 成績確認」
- **戻るボタン**: 学習モード選択画面へ戻る
- **配置**: 画面上部

### 円グラフエリア
- **リスニング成績**: 左側に配置
- **リーディング成績**: 右側に配置
- **グラフ表示**: 正答率を円グラフで視覚化
- **色分け**: 正解（緑）、不正解（赤）
- **パーセンテージ**: グラフ中央に大きく表示
- **配置**: 画面中央上部

### 積み重ね式グラフエリア
- **進捗グラフ**: 語彙習得進捗の日毎推移を表示
- **X軸**: 日付（最近30日間）
- **Y軸**: 習得進捗率（0-100%）
- **データ**: テスト正解により習得した単語の累積
- **配置**: 画面下部


## 状態管理

### 画面パラメータ
- **級情報**: ナビゲーションパラメータで管理（例: `grade: 3`）
- **表示**: ヘッダー部分に級表示

### データ取得
- **語彙習得状態**: 指定された級の各単語がテストで正解したことがあるかをデータベースから取得
- **習得率計算**: リスニング/リーディング別に「正解済み単語数 ÷ 総単語数」で習得率を計算
- **日毎進捗データ**: 積み重ね式グラフ用の日毎習得率スナップショットをデータベースから取得

### 成績の定義
- **成績基準**: テストで正解したかどうか（復習は一切関係なし）
- **習得判定**: 一度でもテストで正解した単語は「習得済み」として記録
- **不可逆性**: 一度習得した単語は、以降間違えても習得状態は変わらない
- **習得率**: 正解済み単語数 ÷ その級の総単語数 × 100（%）

## データ構造

### 語彙習得状態データ
```javascript
// WORD_MASTERYテーブルから動的集計
{
  grade: 3,
  listening_mastered: 150,    // COUNT WHERE test_type='listening'
  reading_mastered: 180       // COUNT WHERE test_type='reading'
}
```

### 日毎進捗スナップショット
```javascript
// LEARNING_PROGRESSテーブル
{
  date: "2025-06-13",
  grade: 3,
  listening_mastered_count: 150,
  reading_mastered_count: 180,
  total_words_count: 2000     // スナップショット時点の総語彙数を保持
}
```

### 円グラフ用データ
```javascript
{
  listening: {
    data: [
      { value: 7.5, color: '#4CAF50', label: '習得済み' },    // listening_mastered / total_words * 100
      { value: 92.5, color: '#F44336', label: '未習得' }     // 残り
    ],
    centerText: '7.5%'
  },
  reading: {
    data: [
      { value: 9.0, color: '#4CAF50', label: '習得済み' },    // reading_mastered / total_words * 100
      { value: 91.0, color: '#F44336', label: '未習得' }     // 残り
    ],
    centerText: '9.0%'
  }
}
```

## 機能詳細

### 円グラフ表示
- **ライブラリ**: React Native Chart Kit または Victory Native
- **アニメーション**: グラフ表示時にアニメーション効果

### 習得率計算
- **リアルタイム更新**: テスト完了時に自動更新
- **精度**: 小数点第1位まで表示
- **データなし**: テスト未実施の場合は「データなし」表示

### 積み重ね式グラフ表示
- **データ更新**: テスト完了時にその日のスナップショットを更新または作成
- **表示方式**: 全期間表示、横スクロール対応
- **更新方式**: updateOrCreate方式で同日は上書き

## ナビゲーション

### 戻るボタン
- **遷移先**: 学習モード選択画面
- **データ保持**: 現在の級情報を維持


## エラーハンドリング

### データなし
- **対応**: プレースホルダー表示「まだテストを実施していません」
- **代替表示**: 0%の円グラフを表示
- **メッセージ**: 「テストを実施すると成績が表示されます」

### データ破損
- **対応**: エラーメッセージ表示「データの読み込みに失敗しました」
- **フォールバック**: 空の状態を表示
- **リセット**: データリセット機能の提供

### グラフ描画失敗
- **対応**: 数値のみの表示に切り替え
- **警告**: 「グラフの表示に失敗しました」

## 技術要件

### 必要なライブラリ
- **グラフライブラリ**: React Native Chart Kit または Victory Native
- **日時処理**: Day.js または date-fns
- **アニメーション**: React Native Reanimated（オプション）

### 必要なデータ
- ナビゲーションパラメータから級情報を取得
- 指定された級の全テスト結果データ
- 円グラフ描画用の色設定

### 必要なデータベーステーブル
- WORD_MASTERY: 語彙習得状態
- LEARNING_PROGRESS: 日毎進捗スナップショット
- WORDS: 級別総語彙数の計算用



---
*ファイル作成日: 2025/6/13*
*実装担当: AIエージェント*